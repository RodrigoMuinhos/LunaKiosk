## Allow the server port to be configured by the hosting platform (Render provides $PORT)
# Use the PORT environment variable when present, otherwise fall back to 8081 for local dev
# Porta 8081 - LunaTotem API (separado do LunaCore:8080 e LunaPay:8082)
server.port=${PORT:8081}
spring.application.name=totem-api

### DATABASE - via env (NUNCA commitar credenciais)
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/lunadb?currentSchema=luna}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.hikari.maximum-pool-size=3
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=15000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=600000

# JPA/Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.default_schema=luna
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
## If the JDBC URL is missing or platform can't provide metadata, Hibernate may fail
## with "Unable to determine Dialect" at startup. Provide an explicit PostgreSQL
## dialect here as a safety fallback.
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Actuator
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized

# Local test helper (for in-memory runs only; keep disabled in prod and do not commit local overrides).
totem.local-test.enabled=false
totem.local-test.admin-email=adm@lunavita.com
totem.local-test.admin-password=adm123

# By default in local/dev we do NOT probe SMTP as a health contributor (it tends to fail when no SMTP creds are configured).
# To enable mail health checks in production set the SPRING_MAIL_HEALTH_ENABLED env var to true.
management.health.mail.enabled=${SPRING_MAIL_HEALTH_ENABLED:false}

# Email Configuration (Gmail)
# Use environment variables for credentials in cloud / render
spring.mail.host=${SPRING_MAIL_HOST:smtp.gmail.com}
spring.mail.port=${SPRING_MAIL_PORT:465}
spring.mail.username=${SPRING_MAIL_USERNAME:}
spring.mail.password=${SPRING_MAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.ssl.enable=true
spring.mail.properties.mail.smtp.ssl.trust=smtp.gmail.com
spring.mail.properties.mail.smtp.connectiontimeout=15000
spring.mail.properties.mail.smtp.timeout=15000
spring.mail.properties.mail.smtp.writetimeout=15000

# LunaPay (BFF/proxy)
# TotemAPI chama LunaPay por trÃ¡s usando o JWT do LunaCore do cliente.
lunapay.base-url=${LUNAPAY_BASE_URL:http://localhost:8082}

# Logging - reduzido para economizar memÃ³ria em produÃ§Ã£o
logging.level.br.lunavita.totemapi=INFO
logging.level.org.hibernate.SQL=WARN
logging.level.org.springframework.web=WARN

# Resend Email API (recommended for Railway - SMTP is blocked)
# Get your API key at https://resend.com
resend.api.key=${RESEND_API_KEY:}
resend.from.email=${RESEND_FROM_EMAIL:onboarding@resend.dev}
resend.webhook.secret=${RESEND_WEBHOOK_SECRET:}

# Payment Configuration
# OBSOLETE: Asaas integration removed - payments now processed externally via LunaPay
# The following properties are kept for backward compatibility but are no longer used:
# asaas.api.url=${ASAAS_API_URL:https://sandbox.asaas.com/api/v3}
# asaas.api.key=${ASAAS_API_KEY:}
# asaas.customer.id=${ASAAS_CUSTOMER_ID:cus_000005979831}

# LGPD - Encryption Configuration
# Generate a 256-bit key: openssl rand -base64 32
# IMPORTANT: Never commit the actual key to version control
# Set this as an environment variable in production
totem.encryption.key=${TOTEM_ENCRYPTION_KEY:}

# LGPD - Data Retention Policy (in days)
totem.data.retention.medical-records=7300
totem.data.retention.financial-records=1825
totem.data.retention.audit-logs=180
totem.data.retention.consents=1825

# Uploads (local dev)
uploads.dir=${UPLOADS_DIR:./uploads}

# LGPD - DPO Contact
totem.dpo.email=${DPO_EMAIL:dpo@lunavita.com}
totem.dpo.phone=${DPO_PHONE:(85) 4002-8922}

# JWT Configuration - MUST match LunaCore secret for token validation
# Defina JWT_SECRET no ambiente. Este default é APENAS para dev local.
jwt.secret=${JWT_SECRET:dev-only-change-me}
jwt.expiration=3600000



